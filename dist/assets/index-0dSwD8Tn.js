(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&d(u)}).observe(document,{childList:!0,subtree:!0});function a(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function d(n){if(n.ep)return;n.ep=!0;const r=a(n);fetch(n.href,r)}})();const T={schema:{size:{default:5}},init(){const l=document.getElementById("board-elements"),t=document.getElementById("board-planes"),{size:a}=this.data,d=a*a;let n=0,r=0;const u=h=>{const m=document.createElement("a-plane");m.setAttribute("id",`board-plane-${h}`),m.setAttribute("class","board-plane"),m.setAttribute("position",`${n.toFixed(2)} 0 ${r.toFixed(2)}`),m.setAttribute("rotation","-90 0 0"),m.setAttribute("color","white"),m.setAttribute("opacity","0.75"),t.appendChild(m),n+=1.1,n>=a&&(n=0,r-=1.1)};(()=>{for(let m=0;m<d;m++)u(m);const h=1.1*(a-1)/2;l.setAttribute("position",`-${h} 0 ${h}`)})()}},e={direction:"RIGHT",moveIndex:0,directionArr:["RIGHT"],dirId:0,points:0,gameover:!1},k={schema:{size:{default:5},isMoving:{default:!1}},init(){const{size:l}=this.data,t=.55,a=(l-1)*1.1+t,d=500,n=this.el.children[0],r=document.getElementById("main-container"),u=document.getElementById("instruction-container"),b=document.getElementById("end-screen-container"),h=document.getElementById("end-screen-points");this.moveSnake=()=>{e.moveIndex++;for(let o=e.directionArr.length-1;o>=0&&o!==0;o--)e.directionArr[o]=e.directionArr[o-1];e.moveIndex%2!==0&&(e.directionArr[0]=e.direction);for(let o=0;o<this.el.children.length;o++){const c=this.el.children[o].getAttribute("position");let i=parseFloat((Math.round(c.x*100)/100).toFixed(2)),s=parseFloat((Math.round(c.z*100)/100).toFixed(2));e.directionArr[o]==="RIGHT"?(Math.abs(i-a)<=.01&&(i=-t),this.el.children[o].setAttribute("animation__position",`property: position; from: ${i} 0 ${s}; to: ${i+t} 0 ${s}; easing: easeInOutQuad; dur: ${d+this.el.children.length*10}`)):e.directionArr[o]==="LEFT"?(Math.abs(i-(0-t))<=.01&&(i=a),this.el.children[o].setAttribute("animation__position",`property: position; from: ${i} 0 ${s}; to: ${i-t} 0 ${s}; easing: easeInOutQuad; dur: ${d+this.el.children.length*10}`)):e.directionArr[o]==="UP"?(Math.abs(s-a*-1)<=.01&&(s=t),this.el.children[o].setAttribute("animation__position",`property: position; from: ${i} 0 ${s}; to: ${i} 0 ${s-t}; easing: easeInOutQuad; dur: ${d+this.el.children.length*10}`)):e.directionArr[o]==="DOWN"?(Math.abs(s-(0+t))<=.01&&(s=-a),this.el.children[o].setAttribute("animation__position",`property: position; from: ${i} 0 ${s}; to: ${i} 0 ${s+t}; easing: easeInOutQuad; dur: ${d+this.el.children.length*10}`)):console.log("Unknown direction")}};const m=()=>{this.moveSnake()};function A(o){const{x:c,y:i,z:s}=o.position,p=l*2+1;function g(B,$,v){const w=Math.round((B-$)/v),C=Math.max(0,Math.min(p-1,w));return $+C*v}const f=g(c,-t,+t),y=g(s,+t,-t);return new THREE.Vector3(f,0,y)}const I=(o,c)=>{const i=document.createElement("a-sphere");this.el.appendChild(i),i.setAttribute("scale","0.3 0.3 0.3"),i.setAttribute("color","darkred"),i.setAttribute("id",`tail-${e.points-1}`),i.setAttribute("class","tail"),i.setAttribute("dynamic-body","mass: 0; shape: sphere; sphereRadius: 0.1;");let s="0 0 0";if(o==="RIGHT")s=`${c.x-t} 0 ${c.z}`;else if(o==="LEFT")s=`${c.x+t} 0 ${c.z}`;else if(o==="UP"){const p=c.z+t;s=`${c.x} 0 ${p}`}else if(o==="DOWN"){const p=c.z-t;s=`${c.x} 0 ${p}`}e.directionArr.push(o),i.setAttribute("position",s)},E=()=>{const c=(l-1)/2,i=Array.from({length:l},(g,f)=>(f-c)*1.1),s=i[Math.floor(Math.random()*i.length)],p=i[Math.floor(Math.random()*i.length)];for(const g of this.el.children){const f=g.getAttribute("position");if(Math.abs(f.x-s)<=.01&&Math.abs(f.z-p)<=.01)return E()}return`${s} 0 ${p}`},x=async()=>{e.gameover=!0,u.style.display="none",b.style.display="block",r.style.display="block",h.innerHTML=`You've scored ${e.points} points`,setTimeout(()=>{r.style.opacity=1})};n.addEventListener("collide",async o=>{if(e.gameover)return;const c=await o.detail.body.el,i=await c.getAttribute("id");if(i&&i.includes("tail")){x();for(let y=0;y<this.el.children.length;y++){this.el.children[y].removeAttribute("animation__position");const M=this.el.children[y].getAttribute("position");this.el.children[y].setAttribute("position",M)}return}e.points++;const{lastElementChild:s}=await this.el,p=e.directionArr[e.directionArr.length-1],g=await A(s.object3D);I(p,g);const f=await E();await c.setAttribute("position",f)}),n.addEventListener("animationcomplete__position",m)},update(){this.data.isMoving&&this.moveSnake()}},L={init(){const l=document.getElementById("direction-right-button"),t=document.getElementById("direction-left-button"),a=d=>{e.dirId=d==="RIGHT"?e.dirId+1:e.dirId-1,e.dirId>3&&(e.dirId=0),e.dirId<0&&(e.dirId=3),e.dirId===0?e.direction="RIGHT":e.dirId===1?e.direction="DOWN":e.dirId===2?e.direction="LEFT":e.dirId===3?e.direction="UP":console.log("Unknown direction id")};l.addEventListener("click",()=>a("RIGHT")),t.addEventListener("click",()=>a("LEFT"))}},P=l=>{l.object3D&&l.object3D.traverse(t=>{t.isMesh&&(t.geometry&&t.geometry.dispose(),t.material&&(Array.isArray(t.material)?t.material.forEach(a=>a.dispose()):t.material.dispose(),t.material.map&&t.material.map.dispose(),t.material.alphaMap&&t.material.alphaMap.dispose(),t.material.lightMap&&t.material.lightMap.dispose(),t.material.bumpMap&&t.material.bumpMap.dispose(),t.material.normalMap&&t.material.normalMap.dispose(),t.material.specularMap&&t.material.specularMap.dispose(),t.material.envMap&&t.material.envMap.dispose()))}),l.remove()},F={init(){const l=document.getElementById("button-start"),t=document.getElementById("button-retry"),a=document.getElementById("point"),d=document.getElementById("snake-container"),n=document.getElementById("main-container"),r=document.getElementById("direction-container");n.style.display="block";const u=()=>{n.style.opacity=0,n.style.pointerEvents="none",setTimeout(()=>{n.style.display="none"},1e3)},b=()=>{d.children[0].setAttribute("position","0 0 0"),a.setAttribute("position","1.1 0 2.2");const A=document.getElementsByClassName("tail");Array.from(A).forEach(I=>{P(I)}),e.direction="RIGHT",e.gameover=!1,e.points=0,e.moveIndex=0,e.directionArr=["RIGHT"],e.dirId=0,d.setAttribute("snake","isMoving: false"),u()},h=()=>{l.removeEventListener("click",h),u(),r.style.display="flex",setTimeout(()=>{r.style.opacity=1}),setTimeout(()=>{d.setAttribute("snake","isMoving: true")},1e3)},m=()=>{b(),setTimeout(()=>{d.setAttribute("snake","isMoving: true")},2e3)};l.addEventListener("click",h),t.addEventListener("click",m)}};AFRAME.registerComponent("board",T);AFRAME.registerComponent("snake",k);AFRAME.registerComponent("direction",L);AFRAME.registerComponent("ui",F);
